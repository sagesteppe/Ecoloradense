occurrence_only <- filter(occ_data, Occurrence == 1) %>%
drop_na(eventDate) %>%
select(-ID, -Occurrence)
library(sf)
library(tidyverse)
library(terra)
source('functions.R')
set.seed(23)
occ_data <- bind_rows(
st_read('../data/collections/occurrences_coloradense/occurrences.shp', quiet = T) %>%
mutate(Occurrence = 1) %>%
st_transform(32613),
st_read('../data/spatial/processed/pseudo-absences/iteration1/absences.shp', quiet = T)
)
res <- c('3arc', '1arc', '1-3arc', '3m')
p2proc <- '../data/spatial/processed'
trails <- st_read('../data/hikingTrails/MtBaldyRoute.shp') %>%
st_make_valid()
trails_buf <- trails %>%
st_transform(32613) %>%
st_buffer(45)
pts <- st_sample(trails_buf, size = 500, type = 'random') %>%
st_as_sf() %>%
st_transform(4326) %>%
rename(geometry = x) %>%
mutate(
Longitude = unlist(map(.$geometry,1)),
Latitude = unlist(map(.$geometry,2)),
Species = 'Points'
)
thinned <- spThin::thin( # no points found within 90m of each other !
loc.data = pts, lat.col = 'Latitude', long.col = 'Longitude', spec.col = 'Species',
thin.par = 0.128, reps = 100, write.files = FALSE, write.log.file = FALSE,
locs.thinned.list.return = TRUE)
thinned <- thinned[[which.max(unlist(lapply(thinned, nrow)))]] %>%
st_as_sf(coords = c(x = 'Longitude', y = 'Latitude'), crs = 4326)
# just checking again...
# st_distance(thinned, thinned[ st_nearest_feature(thinned), ], by_element = T)
ggplot() +
geom_sf(data = trails) +
geom_sf(data = thinned)
#st_write(thinned, '../data/GroundTruthPts/Iteration1.shp', append = TRUE)
rm(pts)
trails <- trails %>%
mutate(Trail = case_when(
id %in% c(1, 2, 3, 66) ~ 'Mt. Baldy',
id %in% c(4) ~ 'Cinnamon',
id %in% c(5) ~ 'Yule Pass',
id %in% c(6) ~ 'Gothic NRA',
id %in% c(8, 9, 11) ~ 'Frigid Air Pass',
id %in% c(19, 20) ~ 'Mt. Bellview',
id %in% c(21) ~ 'Treasury',
id %in% c(12, 13, 14, 15, 16, 17, 18, 52) ~ 'Hasley Pass',
id %in% c(23, 24, 25, 26, 44) ~ 'Virginia Basin',
id %in% c(7, 27, 29) ~ '401',
id %in% c(28, 47, 63, 65) ~ 'Bellview Mines',
id %in% c(36, 69) ~ 'Cassi Mines',
id %in% c(30, 33, 36, 37, 69, 71, 72) ~ 'Copper Lake/East Maroon Pass',
id %in% c(10) ~ 'West Maroon Trail',
id %in% c(35, 38, 39) ~ 'West Maroon Pass',
id %in% c(40, 41, 42, 43, 64, 68) ~ 'North Pole Basin',
id %in% c(45) ~ 'Red Rock',
id %in% c(48, 51) ~ '13043-Cassi Basin',
id %in% c(49, 50) ~ '13043 Ridge',
id %in% c(53) ~ 'Robinson Basin',
id %in% c(47, 61, 62) ~ 'Rustlers Gulch',
id %in% c(67) ~ 'Elko Park',
id %in% c(70) ~ 'Copper Creek',
id %in% c(46, 73, 74, 75, 77) ~ 'Avalanche Lake/Mt. Daly',
.default = as.character('blobby')
)
) %>%
group_by(Trail) %>%
summarize(geometry = st_union(geometry))
st_write(trails, '../data/hikingTrails/trails.shp', append = F)
ggplot(trails) + geom_sf(aes(color = Trail))
trails <- st_transform(trails, 32613)
occurrence_only <- filter(occ_data, Occurrence == 1) %>%
drop_na(eventDate) %>%
select(-ID, -Occurrence)
ob <- OrderRandomPtsIDS(trails, thinned, occurrence_only)
View(occ_data)
ggplot() +
geom_sf(data = occ_data)
ggplot() +
geom_sf(data = occurrence_only)
View(occurrence_only)
st_bbox(occurrence_only)
ggplot() +
geom_sf(data = occurrence_only)
bb <- c(-106.4, 38.0, -106.8, 38.4)
names(bb) <- c('xmin', 'ymin', 'xmax', 'ymax')
bb
occurrence_only |>
st_transform(4326) |>
st_crop(bb)
coche_revisits <- occurrence_only |>
st_transform(4326) |>
st_crop(bb)
ggplot() +
geom_sf(data = coche_revisits)
st_write(coche_revisits, '../data/GroundTruthPts/Iteration1_GroundTruth-Cocheotopa')
coche_revisits <- occurrence_only |>
st_transform(4326) |>
st_crop(bb)
st_write(coche_revisits, '../data/GroundTruthPts/Iteration1_GroundTruth-Cocheotopa.shp')
st_write(coche_revisits, '../data/GroundTruthPts/Iteration1_Revisits-Cocheotopa.shp')
st_layers('/media/steppe/hdd/Geospatial_data/Public_land_ownership/PADUS3_0Geodatabase')
st_read('/media/steppe/hdd/Geospatial_data/Public_land_ownership/PADUS3_0Geodatabase', layer = 'Agency_Type')
st_layers('/media/steppe/hdd/Geospatial_data/Public_land_ownership/PADUS3_0Geodatabase')
st_layers('/media/steppe/hdd/Geospatial_data/Public_land_ownership/PADUS3_0Geodatabase', layer = 'Designation_Type')
st_read('/media/steppe/hdd/Geospatial_data/Public_land_ownership/PADUS3_0Geodatabase', layer = 'Designation_Type')
st_layers('/media/steppe/hdd/Geospatial_data/Public_land_ownership/PADUS3_0Geodatabase/PAD_US3_0.gdb', layer = 'Designation_Type')
st_layers('/media/steppe/hdd/Geospatial_data/Public_land_ownership/PADUS3_0Geodatabase/PAD_US3_0.gdb')
library(sf)
library(tidyverse)
library(terra)
source('functions.R')
set.seed(23)
ground_truth <- read.csv('../data/GroundTruthing/Pts.csv') |>
mutate(
across(c('Dominant_Phen'), ~ na_if(., '')),
across(Presence_M:Presence_J, ~ replace_na(., 0)))
rand_pts_iter1 <- st_read('../data/GroundTruthPts/Iteration1-cp.shp', quiet = T) |>
select(UID) %>%
inner_join(., ground_truth, by = c('UID' = 'GlobalRandomID')) |>
mutate(Site = paste0('r-', UID)) |>
select(-Latitude, -Longitude, -UID)
ground_truth <- filter(ground_truth, is.na(GlobalRandomID)) # remove these random pts
revisits <- st_read('../data/GroundTruthPts/Revisits-cp.shp', quiet = T) |>
select(UID) |>
mutate(UID = str_replace(UID, 'P', 'p')) %>%
inner_join(., filter(ground_truth, str_detect(Site, 'p')), by = c('UID' = 'Site'))
ground_truth <- filter(ground_truth, str_detect(Site, 'p', negate= T)) |>
select(-GlobalRandomID) |>
st_as_sf(coords = c(x = 'Longitude', y = 'Latitude'), crs = 4269) |>
st_transform(st_crs(revisits))
View(ground_truth)
library(sf)
library(tidyverse)
library(terra)
source('functions.R')
set.seed(23)
ground_truth <- read.csv('../data/GroundTruthing/Pts.csv') |>
mutate(
across(c('Dominant_Phen'), ~ na_if(., '')),
across(Presence_M:Presence_J, ~ replace_na(., 0)))
rand_pts_iter1 <- st_read('../data/GroundTruthPts/Iteration1-cp.shp', quiet = T) |>
select(UID) %>%
inner_join(., ground_truth, by = c('UID' = 'GlobalRandomID')) |>
mutate(Site = paste0('r-', UID)) |>
select(-Latitude, -Longitude, -UID)
ground_truth <- filter(ground_truth, is.na(GlobalRandomID)) # remove these random pts
revisits <- st_read('../data/GroundTruthPts/Revisits-cp.shp', quiet = T) |>
select(UID) |>
mutate(UID = str_replace(UID, 'P', 'p')) %>%
inner_join(., filter(ground_truth, str_detect(Site, 'p')), by = c('UID' = 'Site'))
ground_truth <- filter(ground_truth, str_detect(Site, 'p', negate= T)) |>
select(-GlobalRandomID) |>
st_as_sf(coords = c(x = 'Longitude', y = 'Latitude'), crs = 4269) |>
st_transform(st_crs(revisits))
ground_truth <- read.csv('../data/GroundTruthing/Pts.csv') |>
mutate(
across(c('Dominant_Phen'), ~ na_if(., '')),
across(Presence_M:Presence_J, ~ replace_na(., 0)))
rand_pts_iter1 <- st_read('../data/GroundTruthPts/Iteration1-cp.shp', quiet = T) |>
select(UID) %>%
inner_join(., ground_truth, by = c('UID' = 'GlobalRandomID')) |>
mutate(Site = paste0('r-', UID)) |>
select(-Latitude, -Longitude, -UID)
ground_truth <- filter(ground_truth, is.na(GlobalRandomID)) # remove these random pts
revisits <- st_read('../data/GroundTruthPts/Revisits-cp.shp', quiet = T) |>
select(UID) |>
mutate(UID = str_replace(UID, 'P', 'p')) %>%
inner_join(., filter(ground_truth, str_detect(Site, 'p')), by = c('UID' = 'Site'))
ground_truth <- filter(ground_truth, str_detect(Site, 'p', negate= T)) |>
select(-GlobalRandomID) |>
st_as_sf(coords = c(x = 'Longitude', y = 'Latitude'), crs = 4269) |>
st_transform(st_crs(revisits))
View(ground_truth)
revisits
View(revisits)
ground_truth <- filter(ground_truth, str_detect(Site, 'p', negate= T))# |>
View(ground_truth)
ground_truth <- filter(ground_truth, str_detect(Site, 'p', negate= T)) |>
select(-GlobalRandomID) |>
st_as_sf(coords = c(x = 'Longitude', y = 'Latitude'), crs = 4269) |>
st_transform(st_crs(revisits))
ground_truth <- filter(ground_truth, str_detect(Site, 'p', negate= T)) #|>
ground_truth <- read.csv('../data/GroundTruthing/Pts.csv') |>
mutate(
across(c('Dominant_Phen'), ~ na_if(., '')),
across(Presence_M:Presence_J, ~ replace_na(., 0)))
rand_pts_iter1 <- st_read('../data/GroundTruthPts/Iteration1-cp.shp', quiet = T) |>
select(UID) %>%
inner_join(., ground_truth, by = c('UID' = 'GlobalRandomID')) |>
mutate(Site = paste0('r-', UID)) |>
select(-Latitude, -Longitude, -UID)
ground_truth <- filter(ground_truth, is.na(GlobalRandomID)) # remove these random pts
revisits <- st_read('../data/GroundTruthPts/Revisits-cp.shp', quiet = T) |>
select(UID) |>
mutate(UID = str_replace(UID, 'P', 'p')) %>%
inner_join(., filter(ground_truth, str_detect(Site, 'p')), by = c('UID' = 'Site'))
ground_truth <- filter(ground_truth, str_detect(Site, 'p', negate= T)) #|>
select(-GlobalRandomID) |>
st_as_sf(coords = c(x = 'Longitude', y = 'Latitude'), crs = 4269) |>
st_transform(st_crs(revisits))
ground_truth <- filter(ground_truth, str_detect(Site, 'p', negate= T)) |>
select(-GlobalRandomID) |>
st_as_sf(coords = c(x = 'Longitude', y = 'Latitude'), crs = 4269) |>
st_transform(st_crs(revisits))
View(ground_truth)
View(revisits)
st_read('../data/GroundTruthPts/Revisits-cp.shp', quiet = T)
revisits <- st_read('../data/GroundTruthPts/Revisits-cp.shp', quiet = T) |>
select(UID) |>
mutate(UID = str_replace(UID, 'P', 'p')) #%>%
View(revisits)
View(ground_truth)
ground_truth <- read.csv('../data/GroundTruthing/Pts.csv') |>
mutate(
across(c('Dominant_Phen'), ~ na_if(., '')),
across(Presence_M:Presence_J, ~ replace_na(., 0)))
rand_pts_iter1 <- st_read('../data/GroundTruthPts/Iteration1-cp.shp', quiet = T) |>
select(UID) %>%
inner_join(., ground_truth, by = c('UID' = 'GlobalRandomID')) |>
mutate(Site = paste0('r-', UID)) |>
select(-Latitude, -Longitude, -UID)
ground_truth <- filter(ground_truth, is.na(GlobalRandomID)) # remove these random pts
revisits <- st_read('../data/GroundTruthPts/Revisits-cp.shp', quiet = T) |>
select(UID) |>
mutate(UID = str_replace(UID, 'P', 'p')) %>%
inner_join(., filter(ground_truth, str_detect(Site, 'p')), by = c('UID' = 'Site'))
ground_truth <- filter(ground_truth, str_detect(Site, 'p', negate= T)) |>
select(-GlobalRandomID) |>
st_as_sf(coords = c(x = 'Longitude', y = 'Latitude'), crs = 4269) |>
st_transform(st_crs(revisits))
View(revisits)
st_read('../data/GroundTruthPts/Revisits-cp.shp', quiet = T)
revisits <- st_read('../data/GroundTruthPts/Revisits-cp.shp', quiet = T) #|>
View(revisits)
revisits <- st_read('../data/GroundTruthPts/Revisits-cp.shp', quiet = T) |>
select(UID) |>
mutate(UID = str_replace(UID, 'P', 'p')) #%>%
ground_truth
revisits <- st_read('../data/GroundTruthPts/Revisits-cp.shp', quiet = T) |>
select(UID) |>
mutate(UID = str_replace(UID, 'P', 'p')) %>%
inner_join(., filter(ground_truth, str_detect(Site, 'p')), by = c('UID' = 'Site'))
ground_truth <- read.csv('../data/GroundTruthing/Pts.csv') |>
mutate(
across(c('Dominant_Phen'), ~ na_if(., '')),
across(Presence_M:Presence_J, ~ replace_na(., 0)))
rand_pts_iter1 <- st_read('../data/GroundTruthPts/Iteration1-cp.shp', quiet = T) |>
select(UID) %>%
inner_join(., ground_truth, by = c('UID' = 'GlobalRandomID')) |>
mutate(Site = paste0('r-', UID)) |>
select(-Latitude, -Longitude, -UID)
ground_truth <- filter(ground_truth, is.na(GlobalRandomID)) # remove these random pts
revisits <- st_read('../data/GroundTruthPts/Revisits-cp.shp', quiet = T) |>
select(UID) |>
mutate(UID = str_replace(UID, 'P', 'p')) %>%
inner_join(., filter(ground_truth, str_detect(Site, 'p')), by = c('UID' = 'Site'))
ground_truth <- filter(ground_truth, str_detect(Site, 'p', negate= T)) |>
select(-GlobalRandomID) |>
st_as_sf(coords = c(x = 'Longitude', y = 'Latitude'), crs = 4269) |>
st_transform(st_crs(revisits))
View(revisits)
revisits <- filter(revisits, !is.na(Latitude)) |>
st_drop_geometry() |>
st_as_sf(coords = c(x = 'Longitude', y = 'Latitude'), crs = 4269) |>
st_transform(st_crs(revisits)) %>%
bind_rows(., filter(revisits, is.na(Latitude))) |>
mutate(Site = UID) |>
select(-Latitude, -Longitude, -UID)
View(revisits)
ground_truth <- bind_rows(ground_truth, rand_pts_iter1, revisits) |>
select(-GlobalRandomID) %>%
mutate(Presence = ifelse(Presence_M > 0 | Presence_J > 0, 1, 0), .after = Presence_J)
st_write(ground_truth, '../data/GroundTruthing/QC.shp', append = F)
rm(rand_pts_iter1, revisits)
library(sf)
library(tidyverse)
library(terra)
source('functions.R')
set.seed(23)
ground_truth <- read.csv('../data/GroundTruthing/Pts.csv') |>
mutate(
across(c('Dominant_Phen'), ~ na_if(., '')),
across(Presence_M:Presence_J, ~ replace_na(., 0)))
rand_pts_iter1 <- st_read('../data/GroundTruthPts/Iteration1-cp.shp', quiet = T) |>
select(UID) %>%
inner_join(., ground_truth, by = c('UID' = 'GlobalRandomID')) |>
mutate(Site = paste0('r-', UID)) |>
select(-Latitude, -Longitude, -UID)
ground_truth <- filter(ground_truth, is.na(GlobalRandomID)) # remove these random pts
revisits <- st_read('../data/GroundTruthPts/Revisits-cp.shp', quiet = T) |>
select(UID) |>
mutate(UID = str_replace(UID, 'P', 'p')) %>%
inner_join(., filter(ground_truth, str_detect(Site, 'p')), by = c('UID' = 'Site'))
ground_truth <- filter(ground_truth, str_detect(Site, 'p', negate= T)) |>
select(-GlobalRandomID) |>
st_as_sf(coords = c(x = 'Longitude', y = 'Latitude'), crs = 4269) |>
st_transform(st_crs(revisits))
revisits <- filter(revisits, !is.na(Latitude)) |>
st_drop_geometry() |>
st_as_sf(coords = c(x = 'Longitude', y = 'Latitude'), crs = 4269) |>
st_transform(st_crs(revisits)) %>%
bind_rows(., filter(revisits, is.na(Latitude))) |>
mutate(Site = UID) |>
select(-Latitude, -Longitude, -UID)
ground_truth <- bind_rows(ground_truth, rand_pts_iter1, revisits) |>
select(-GlobalRandomID) %>%
mutate(Presence = ifelse(Presence_M > 0 | Presence_J > 0, 1, 0), .after = Presence_J)
st_write(ground_truth, '../data/GroundTruthing/QC.shp', append = F)
rm(rand_pts_iter1, revisits)
View(ground_truth)
filter(ground_truth, Presence == 1)
View(ground_truth)
gt_pres <- filter(ground_truth, Presence == 1)
gt_pres <- filter(ground_truth, Presence == 1) |>
dplyr::select(NAME = Collector_n_Number, Description = UNIQUEID) |>
sf::st_write(dsn = fname, driver = filetype,
delete_dsn = TRUE, quiet = T, append = F)
View(ground_truth)
View(gt_pres)
gt_pres <- filter(ground_truth, Presence == 1) |>
dplyr::select(NAME = OBJECT) |>
sf::st_write(dsn = '../data/GroundTruthing/Presences.shp', driver = '.kml',
delete_dsn = TRUE, quiet = T, append = F)
gt_pres <- filter(ground_truth, Presence == 1) |>
dplyr::select(NAME = OBJECT) |>
sf::st_write(dsn = '../data/GroundTruthing/Presences.shp', driver = 'kml',
quiet = T, append = F)
gt_pres <- filter(ground_truth, Presence == 1) |>
dplyr::select(NAME = OBJECT) |>
sf::st_write(dsn = '../data/GroundTruthing/Presences', driver = 'kml',
quiet = T, append = F)
gt_pres <- filter(ground_truth, Presence == 1) |>
dplyr::select(NAME = OBJECT) |>
sf::st_write(dsn = '../data/GroundTruthing/Presences', driver = 'kml',
quiet = T, append = F)
gt_pres <- filter(ground_truth, Presence == 1) |>
dplyr::select(NAME = OBJECT) |>
sf::st_write(dsn = '../data/GroundTruthing/Presences.kml', driver = 'kml',
quiet = T, append = F)
library(sf)
library(tidyverse)
library(terra)
source('functions.R')
set.seed(23)
ground_truth <- read.csv('../data/GroundTruthing/Pts.csv') |>
mutate(
across(c('Dominant_Phen'), ~ na_if(., '')),
across(Presence_M:Presence_J, ~ replace_na(., 0)))
rand_pts_iter1 <- st_read('../data/GroundTruthPts/Iteration1-cp.shp', quiet = T) |>
select(UID) %>%
inner_join(., ground_truth, by = c('UID' = 'GlobalRandomID')) |>
mutate(Site = paste0('r-', UID)) |>
select(-Latitude, -Longitude, -UID)
ground_truth <- filter(ground_truth, is.na(GlobalRandomID)) # remove these random pts
revisits <- st_read('../data/GroundTruthPts/Revisits-cp.shp', quiet = T) |>
select(UID) |>
mutate(UID = str_replace(UID, 'P', 'p')) %>%
inner_join(., filter(ground_truth, str_detect(Site, 'p')), by = c('UID' = 'Site'))
ground_truth <- filter(ground_truth, str_detect(Site, 'p', negate= T)) |>
select(-GlobalRandomID) |>
st_as_sf(coords = c(x = 'Longitude', y = 'Latitude'), crs = 4269) |>
st_transform(st_crs(revisits))
revisits <- filter(revisits, !is.na(Latitude)) |>
st_drop_geometry() |>
st_as_sf(coords = c(x = 'Longitude', y = 'Latitude'), crs = 4269) |>
st_transform(st_crs(revisits)) %>%
bind_rows(., filter(revisits, is.na(Latitude))) |>
mutate(Site = UID) |>
select(-Latitude, -Longitude, -UID)
ground_truth <- bind_rows(ground_truth, rand_pts_iter1, revisits) |>
select(-GlobalRandomID) %>%
mutate(Presence = ifelse(Presence_M > 0 | Presence_J > 0, 1, 0), .after = Presence_J)
st_write(ground_truth, '../data/GroundTruthing/QC.shp', append = F)
rm(rand_pts_iter1, revisits)
gt_pres <- filter(ground_truth, Presence == 1) |>
dplyr::select(NAME = OBJECT) |>
sf::st_write(dsn = '../data/GroundTruthing/Presences.kml', driver = 'kml',
quiet = T, append = F)
gt_pres <- filter(ground_truth, Presence == 1) |>
dplyr::select(NAME = OBJECT) |>
sf::st_write(dsn = '../data/GroundTruthing/Presences.kml', driver = 'kml',
quiet = T, append = F)
View(gt_pres)
comp_abs <- read.csv('../data/GroundTruthing/ComputerAbs.csv') |>
mutate(Presence_M = 0, Presence_J = 0, Presence = 0) |>
st_as_sf(coords = c(x = 'Longitude', y = 'Latitude'), crs = 4326) |>
st_transform(st_crs(ground_truth))
gt_pres <- filter(ground_truth, Presence == 1) |>
dplyr::select(NAME = OBJECT) |>
sf::st_write(dsn = '../data/GroundTruthing/Presences.kml', driver = 'kml',
quiet = T, append = F)
gt_abs <- filter(ground_truth, Presence == 0) |>
dplyr::select(NAME = OBJECT) |>
sf::st_write(dsn = '../data/GroundTruthing/Absences.kml', driver = 'kml',
quiet = T, append = F)
library(sf)
library(tidyverse)
library(terra)
source('functions.R')
set.seed(23)
ground_truth <- read.csv('../data/GroundTruthing/Pts.csv') |>
mutate(
across(c('Dominant_Phen'), ~ na_if(., '')),
across(Presence_M:Presence_J, ~ replace_na(., 0)))
rand_pts_iter1 <- st_read('../data/GroundTruthPts/Iteration1-cp.shp', quiet = T) |>
select(UID) %>%
inner_join(., ground_truth, by = c('UID' = 'GlobalRandomID')) |>
mutate(Site = paste0('r-', UID)) |>
select(-Latitude, -Longitude, -UID)
ground_truth <- filter(ground_truth, is.na(GlobalRandomID)) # remove these random pts
revisits <- st_read('../data/GroundTruthPts/Revisits-cp.shp', quiet = T) |>
select(UID) |>
mutate(UID = str_replace(UID, 'P', 'p')) %>%
inner_join(., filter(ground_truth, str_detect(Site, 'p')), by = c('UID' = 'Site'))
ground_truth <- filter(ground_truth, str_detect(Site, 'p', negate= T)) |>
select(-GlobalRandomID) |>
st_as_sf(coords = c(x = 'Longitude', y = 'Latitude'), crs = 4269) |>
st_transform(st_crs(revisits))
revisits <- filter(revisits, !is.na(Latitude)) |>
st_drop_geometry() |>
st_as_sf(coords = c(x = 'Longitude', y = 'Latitude'), crs = 4269) |>
st_transform(st_crs(revisits)) %>%
bind_rows(., filter(revisits, is.na(Latitude))) |>
mutate(Site = UID) |>
select(-Latitude, -Longitude, -UID)
ground_truth <- bind_rows(ground_truth, rand_pts_iter1, revisits) |>
select(-GlobalRandomID) %>%
mutate(Presence = ifelse(Presence_M > 0 | Presence_J > 0, 1, 0), .after = Presence_J)
st_write(ground_truth, '../data/GroundTruthing/QC.shp', append = F)
rm(rand_pts_iter1, revisits)
gt_pres <- filter(ground_truth, Presence == 1) |>
dplyr::select(NAME = OBJECT) |>
sf::st_write(dsn = '../data/GroundTruthing/Presences.kml', driver = 'kml',
quiet = T, append = F)
gt_abs <- filter(ground_truth, Presence == 0) |>
dplyr::select(NAME = OBJECT) |>
sf::st_write(dsn = '../data/GroundTruthing/Absences.kml', driver = 'kml',
quiet = T, append = F)
library(sf)
library(tidyverse)
library(terra)
source('functions.R')
set.seed(23)
ground_truth <- read.csv('../data/GroundTruthing/Pts.csv') |>
mutate(
across(c('Dominant_Phen'), ~ na_if(., '')),
across(Presence_M:Presence_J, ~ replace_na(., 0)))
rand_pts_iter1 <- st_read('../data/GroundTruthPts/Iteration1-cp.shp', quiet = T) |>
select(UID) %>%
inner_join(., ground_truth, by = c('UID' = 'GlobalRandomID')) |>
mutate(Site = paste0('r-', UID)) |>
select(-Latitude, -Longitude, -UID)
ground_truth <- filter(ground_truth, is.na(GlobalRandomID)) # remove these random pts
revisits <- st_read('../data/GroundTruthPts/Revisits-cp.shp', quiet = T) |>
select(UID) |>
mutate(UID = str_replace(UID, 'P', 'p')) %>%
inner_join(., filter(ground_truth, str_detect(Site, 'p')), by = c('UID' = 'Site'))
ground_truth <- filter(ground_truth, str_detect(Site, 'p', negate= T)) |>
select(-GlobalRandomID) |>
st_as_sf(coords = c(x = 'Longitude', y = 'Latitude'), crs = 4269) |>
st_transform(st_crs(revisits))
ground_truth <- filter(ground_truth, str_detect(Site, 'p', negate= T)) |>
select(-GlobalRandomID) |>
st_as_sf(coords = c(x = 'Longitude', y = 'Latitude'), crs = 4269) |>
st_transform(st_crs(revisits))
library(sf)
library(tidyverse)
library(terra)
source('functions.R')
set.seed(23)
ground_truth <- read.csv('../data/GroundTruthing/Pts.csv') |>
mutate(
across(c('Dominant_Phen'), ~ na_if(., '')),
across(Presence_M:Presence_J, ~ replace_na(., 0)))
rand_pts_iter1 <- st_read('../data/GroundTruthPts/Iteration1-cp.shp', quiet = T) |>
select(UID) %>%
inner_join(., ground_truth, by = c('UID' = 'GlobalRandomID')) |>
mutate(Site = paste0('r-', UID)) |>
select(-Latitude, -Longitude, -UID)
ground_truth <- filter(ground_truth, is.na(GlobalRandomID)) # remove these random pts
revisits <- st_read('../data/GroundTruthPts/Revisits-cp.shp', quiet = T) |>
select(UID) |>
mutate(UID = str_replace(UID, 'P', 'p')) %>%
inner_join(., filter(ground_truth, str_detect(Site, 'p')), by = c('UID' = 'Site'))
ground_truth <- filter(ground_truth, str_detect(Site, 'p', negate= T)) |>
select(-GlobalRandomID) |>
st_as_sf(coords = c(x = 'Longitude', y = 'Latitude'), crs = 4269) |>
st_transform(st_crs(revisits))
revisits <- filter(revisits, !is.na(Latitude)) |>
st_drop_geometry() |>
st_as_sf(coords = c(x = 'Longitude', y = 'Latitude'), crs = 4269) |>
st_transform(st_crs(revisits)) %>%
bind_rows(., filter(revisits, is.na(Latitude))) |>
mutate(Site = UID) |>
select(-Latitude, -Longitude, -UID)
comp_abs <- read.csv('../data/GroundTruthing/ComputerAbs.csv') |>
mutate(Presence_M = 0, Presence_J = 0, Presence = 0) |>
st_as_sf(coords = c(x = 'Longitude', y = 'Latitude'), crs = 4326) |>
st_transform(st_crs(ground_truth))
ab <- bind_rows(ground_truth, comp_abs) |>
st_write('../data/GroundTruthing/Iteration1Pts.shp', append = F)
library(spdep)
nn5 = knn2nb(knearneigh(ab, 8))
w = nb2listw(nn5, style="B")
joincount.test( as.factor(ab$Presence), w)
